=head1 NAME

gedafe-user - the Generic Database Frontend (Gedafe) User-Manual

=head1 DESCRIPTION

Gedafe (the Generic Database Frontend) is a web-based database frontend
that is database-application independent. That means that the (perl) code
doesn't contain any information about what tables are present in the
database or how the data is organized.

This is only possible if a fullfeatured SQL dB server like PostgreSQL
is used as backend. PostgreSQL permits to define not only the format
of the various tables and fields but also how tables are related to
each other. It is even possible to write powerful functions inside the
database which get executed as new data is accessed or modified.

The effect of this is, that the database server guarantees the
integrity of the database independently from the software used to
access the database.  The frontend can read all the integrity
constraints directly off the database and enforce them itself in order
to provide faster response to the user, but at the end of the day the
database server will only accept data which fits its own rules.

Overall, this approach makes the creation and maintenance of Database
applications much simpler. New databases can be created on the
database server alone, using the language which is best suited for
this task: SQL. The frontend then comes almost for free.

=head2 Features

Gedafe has the following features:

=over 4

=item *

It is completely I<generic>. Gedafe does not need to know anything
about the structure or contents of the database it is working with.

=item * 

I<Authentication> is done at the database-level. And it is URL
transparent.  This means you can directly go to the URL of the page
you want to look at, if necessary, the login screen will pop up and
after successful login you will be transported to the page you
initially requested. 

=item *

Almost no HTML is used in the frontend code. External template files
define the look and feel of pages.

=item *

POST is used only for data that modifies the database. Every page has
a distinc URL, which makes them storable as bookmarks (Deep Linking).

=item *

I<Double form protection>. It is not possible to accidently submit the
same form twice. Because in each form comes with a unique serial
number.

=back

=head1 INSTALLATION

The structure of the Gedafe distribution is as follows:

 .
 |-- bin/              binaries (gedafed daemon)
 |-- doc/              documentation
 |-- lib/              
 |   `-- perl/
 |       `-- Gedafe/    gedafed main source
 `-- example
     |-- templates/    HTML templates
     |-- demo.cgi     demo-application  script
     `-- demo.sql     PostgreSQL script to initialize the
                      demo-application database

In order to start using gedafe you have to ensure that F<lib/perl> of
the Gedafe distribution is found by F<perl> and start the F<gedafed>
daemon (you can use the script gedafed-ctl to start it with
SYSV-init).

=head2 The Application Script

Gedafe is actually a library. The application itself just calls the
'Start' function of the library, providing the necessary configuration
information as arguments. The application startup script should look
as follows:

 #!/usr/sepp/bin/speedy -w
 
 use lib "/usr/local/gedafe/lib/perl";
 
 use Gedafe::Start;
 
 Start(
 	app_site       => 'mysite.com:8000',
 	app_path       => '/cgi-bin/demo',
 	db_datasource  => 'dbi:Pg:dbname=demo',
 	list_rows      => 15,
 	admin_user     => 'admin',
 	templates      => '/usr/local/gedafe/templates/demo',
 	documentation_url => 'http://mysite.com/demo-docs',
 );

Gedafe gathers information about the database structure when it is
started.  This process can take a lot of time, it is therefor strongly
suggested that you use a persistent perl instance with for example
I<speedy>. I<mod_perl> works also great, but you have to be careful if
you run multiple database applications, since if the same persistent
perl is used, the cached data of the applications will go in the same
global variable, which is certainly not what you want.

Very important in this script is the first 'use' statement. It should
point to where you have stored F<lib/perl> of the
distribution. I<Start> starts the application by specifying Gedafe
configuration variables. The following configuration variables are
defined:

=over 20

=item app_site

Site-part of the URL where the application resides.

=item app_path

Path-part of the URL where the application resides.

=item db_datasource

DBI data-source string specifying the database.

=item list_rows

Default number of rows to show.

=item admin_user

Name of the administrator user. A tag is passed to the html templates
when the user is this one to for example change the background color.

=item templates

Directory where the html templates are stored (copy as a basis
F<example/templates>)

=item documentation_url

URL passed to the html templates where the documentation of the
application is stored.

=back

=head2 The gedafed Daemon

Gedafe uses an external process to manage session data called
gedafed. This daemon must be running to make Gedafe work. You can
start it in the init phase using the bin/gedafed-ctl script.

=head2 The Database

F<gedafe-sql.pod> describes how the database should be setup to work with
Gedafe.

=head1 USAGE

=head2 Authentication

Authentication is done with the help of gedafed. This daemon stores
user/password pairs using a random-generated "ticket", which is stored in a
cookie on the client side. To make these tickets more secure gedafed manages an
expiration on these tickets. Every time that ticket is used, it's expiration
is prolonged by a certain amount (configured in the script) of seconds. The
result is that if the database isn't accessed for a certain amount of time,
the ticket isn't anymore valid and login must be made.

The login screen is transparent to the page accessed: whenever a login is
needed, the login screen is first presented, after which the requested page is
shown.

=head2 Forms and Navigation

The navigation and general use of Gedafe should be straightforward. At the
beginning, you are presented with the "Entry" page that contains links to every
table to edit and every available report.

For forms, the guiding principle while designing Gedafe was 'POST is evil, use
it the less possible'. The reason for it is that if a generated page depends on
POST data, that page can't be stored in a bookmark and the browsers have
problems handling the reloading of pages obtained with a POST request. For that
reason, POST was used only for database-modifying actions that needed to
transfer large amounts of data.

=head2 HTML Layout

Almost no HTML is present in the perl code. The HTML is generated with the help
of Text::CPPTemplate, a very simple C-preprocessor-style templating system
included in the Gedafe distribution. The templates are taken from a directory
specified in the startup script with the 'templates' parameter.

The basic idea is that Gedafe places small "elements" of the page currently
being generated such as the header or the cell of a table by only specifying
variables (properties) of that element. Every element has always the following
minimal variables specified:

=over 10

=item PAGE

Name of the page (for example I<login>, I<entry> or I<list>).

=item ELEMENT

Name of the element (for example I<header> or I<td>).

=back

In addition to these, element-specific data such as I<DATA> for the I<td>
element must be defined. Text::CPPTemplate will then search for an appropriate
template to use and generate the HTML code. See L<Text::CPPTemplate(3)> for a
description of the syntax and how the templates are stored in files. See also
F<gedafe-templates.txt> for a description of what elements are used with what
variables.

=head2 Hidden features

=over 4

=item *

In the URL: C<listrows=nn> override the number-of-displayed-rows specified in
the startup script.

=item *

In the URL: C<theme=xxx> set the theme (templates will be loaded from that
subdirectory of the templates directory)

=item *

In the URL: C<reload=1> reset all the cached data. This is useful if you for
example change a template file or the structure of the database.

=item *

C<today> or C<yesterday> can be specified as search value for a 'Date' field.

=item *


Numbers can be entered as C<hh:mm> (for example C<0:10>). The C<mm> part will
be multiplied by 100/60 and added to C<hh>.

=back

=head2 Caching and Bookmarks

A difficulty that we encountered while developing Gedafe was the caching of
pages by the browser.  We have to control precisely when a page can be cached
and when not. The implementation is made with the C<refresh> URL parameter:
when it is set, the expiration of the page is set to some positive value,
meaning that the page can be cached, and when not available, the expiration is
negative, meaning that the page should not be cached. The value of C<refresh>
is a random number, that we can change to force a reload of the page.

A side-effect of this technique is that pages with C<refresh> in the URL are
not suitable to be stored as bookmarks, since you would then get always the
same cached version. For that reason, bookmarks should be always saved without
the C<refresh> parameter, such that a new version of the page is always
requested to the server. There is a link on every page, that you can drag to
store the currently viewed page.

=head1 FUTURE WORK

=over 4

=item *

Ports to other databases such as Ingres and Oracle.

=item *

We will probably change completely or improve the templating system, since it is very
primitive right now. A possibility is Template::Toolkit.

=item *

We will integrate PearlReports (by Tobias Oetiker <oetiker@ee.ethz.ch>, not yet
released) into Gedafe to allow generating with the HTML interface real reports
in HTML and perhaps also directly in PDF.

=item *

Internal code cleanup. We are evaluating if now that we have experience on how
to do such an application right from the beginning, a better implementation
could be gained through a rewrite.

=back

=head1 SEE ALSO

F<gedafe-sql.pod>, F<gedafe-templates.txt>

=head1 COPYRIGHT

Copyright (c) 2000 ETH Zurich, All rights reserved.

=head1 LICENSE

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

=head1 AUTHOR

David Schweikert <dws@ee.ethz.ch> and
Tobias Oetiker <oetiker@ee.ethz.ch>
